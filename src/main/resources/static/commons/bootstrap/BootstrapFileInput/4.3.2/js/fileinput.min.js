!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=a(require("jquery")):a(window.jQuery)}(function(bd){bd.fn.fileinputLocales={},bd.fn.fileinputThemes={};var aY,a9,bi,a4,a0,a3,a6,aZ,be,bf,a2,aX,bc,a5,bb,aW,ba,aU,bj,bg,aC,aT,aR,aj,ay,az,a7,aK,av,ak,an,aB,aQ,aF,ai,a8,ar,ab,ao,aE,al,aq,ap,aw,a1,ag,ah,at,ax,ad,ac,au,am,bh,af,aN,aA,aa,aS,aP,aO,aJ,aD,aL,aI,aV,aM,aH,aG;aY=".fileinput",a9="kvFileinputModal",bi='style="width:{width};height:{height};"',a4='<param name="controller" value="true" />\n<param name="allowFullScreen" value="true" />\n<param name="allowScriptAccess" value="always" />\n<param name="autoPlay" value="false" />\n<param name="autoStart" value="false" />\n<param name="quality" value="high" />\n',a0='<div class="file-preview-other">\n<span class="{previewFileIconClass}">{previewFileIcon}</span>\n</div>',a3=window.URL||window.webkitURL,a6=function(c,b,a){return void 0!==c&&(a?c===b:c.match(b))},aZ=function(c){if("Microsoft Internet Explorer"!==navigator.appName){return !1}if(10===c){return new RegExp("msie\\s"+c,"i").test(navigator.userAgent)}var b,a=document.createElement("div");return a.innerHTML="<!--[if IE "+c+"]> <i></i> <![endif]-->",b=a.getElementsByTagName("i").length,document.body.appendChild(a),a.parentNode.removeChild(a),b},be=function(){return new RegExp("Edge/[0-9]+","i").test(navigator.userAgent)},bf=function(f,c,b,g){var d=g?c:c.split(" ").join(aY+" ")+aY;f.off(d).on(d,b)},a2={data:{},init:function(c){var b=c.initialPreview,a=c.id;b.length>0&&!aS(b)&&(b=b.split(c.initialPreviewDelimiter)),a2.data[a]={content:b,config:c.initialPreviewConfig,tags:c.initialPreviewThumbTags,delimiter:c.initialPreviewDelimiter,previewFileType:c.initialPreviewFileType,previewAsData:c.initialPreviewAsData,template:c.previewGenericTemplate,showZoom:c.fileActionSettings.showZoom,showDrag:c.fileActionSettings.showDrag,getSize:function(d){return c._getSize(d)},parseTemplate:function(g,f,e,m,j,k,d){var h=" file-preview-initial";return c._generatePreviewTemplate(g,f,e,m,j,!1,null,h,k,d)},msg:function(d){return c._getMsgSelected(d)},initId:c.previewInitId,footer:c._getLayoutTemplate("footer").replace(/\{progress}/g,c._renderThumbProgress()),isDelete:c.initialPreviewShowDelete,caption:c.initialCaption,actions:function(g,f,e,k,h,j,d){return c._renderFileActions(g,f,e,k,h,j,d,!0)}}},fetch:function(a){return a2.data[a].content.filter(function(b){return null!==b})},count:function(b,a){return a2.data[b]&&a2.data[b].content?a?a2.data[b].content.length:a2.fetch(b).length:0},get:function(E,q,B){var j,b,e,p,F,z,A="init_"+q,D=a2.data[E],y=D.config[q],k=D.content[q],x=D.initId+"-"+A,C=" file-preview-initial",w=aP("previewAsData",y,D.previewAsData);return B=void 0===B?!0:B,k?(y&&y.frameClass&&(C+=" "+y.frameClass),w?(e=D.previewAsData?aP("type",y,D.previewFileType||"generic"):"generic",p=aP("caption",y),F=a2.footer(E,q,B,y&&y.size||null),z=aP("filetype",y,e),j=D.parseTemplate(e,k,p,z,x,F,A,null)):j=D.template.replace(/\{previewId}/g,x).replace(/\{frameClass}/g,C).replace(/\{fileindex}/g,A).replace(/\{content}/g,D.content[q]).replace(/\{template}/g,aP("type",y,D.previewFileType)).replace(/\{footer}/g,a2.footer(E,q,B,y&&y.size||null)),D.tags.length&&D.tags[q]&&(j=aD(j,D.tags[q])),aa(y)||aa(y.frameAttr)||(b=bd(document.createElement("div")).html(j),b.find(".file-preview-initial").attr(y.frameAttr),j=b.html(),b.remove()),j):""},add:function(e,d,c,h,f){var g,b=bd.extend(!0,{},a2.data[e]);return aS(d)||(d=d.split(b.delimiter)),f?(g=b.content.push(d)-1,b.config[g]=c,b.tags[g]=h):(g=d.length-1,b.content=d,b.config=c,b.tags=h),a2.data[e]=b,g},set:function(e,d,c,j,g){var h,b,f=bd.extend(!0,{},a2.data[e]);if(d&&d.length&&(aS(d)||(d=d.split(f.delimiter)),b=d.filter(function(a){return null!==a}),b.length)){if(void 0===f.content&&(f.content=[]),void 0===f.config&&(f.config=[]),void 0===f.tags&&(f.tags=[]),g){for(h=0;h<d.length;h++){d[h]&&f.content.push(d[h])}for(h=0;h<c.length;h++){c[h]&&f.config.push(c[h])}for(h=0;h<j.length;h++){j[h]&&f.tags.push(j[h])}}else{f.content=d,f.config=c,f.tags=j}a2.data[e]=f}},unset:function(c,b){var a=a2.count(c);if(a){if(1===a){return a2.data[c].content=[],a2.data[c].config=[],void (a2.data[c].tags=[])}a2.data[c].content[b]=null,a2.data[c].config[b]=null,a2.data[c].tags[b]=null}},out:function(g){var d,c="",b=a2.data[g],h=a2.count(g,!0);if(0===h){return{content:"",caption:""}}for(var f=0;h>f;f++){c+=a2.get(g,f)}return d=b.msg(a2.count(g)),{content:'<div class="file-initial-thumbs">'+c+"</div>",caption:d}},footer:function(y,E,q,B){var j=a2.data[y];if(q=void 0===q?!0:q,0===j.config.length||aa(j.config[E])){return""}var b=j.config[E],h=aP("caption",b),p=aP("width",b,"auto"),F=aP("url",b,!1),z=aP("key",b,null),A=aP("showDelete",b,!0),D=aP("showZoom",b,j.showZoom),x=aP("showDrag",b,j.showDrag),k=F===!1&&q,w=j.isDelete?j.actions(!1,A,D,x,k,F,z):"",C=j.footer.replace(/\{actions}/g,w);return C.replace(/\{caption}/g,h).replace(/\{size}/g,j.getSize(B)).replace(/\{width}/g,p).replace(/\{indicator}/g,"").replace(/\{indicatorTitle}/g,"")}},aX=function(b,a){return a=a||0,"number"==typeof b?b:("string"==typeof b&&(b=parseFloat(b)),isNaN(b)?a:b)},bc=function(){return !(!window.File||!window.FileReader)},a5=function(){var a=document.createElement("div");return !aZ(9)&&!be()&&(void 0!==a.draggable||void 0!==a.ondragstart&&void 0!==a.ondrop)},bb=function(){return bc()&&window.FormData},aW=function(b,a){b.removeClass(a).addClass(a)},ad={showRemove:!0,showUpload:!0,showZoom:!0,showDrag:!0,removeIcon:'<i class="glyphicon glyphicon-trash text-danger"></i>',removeClass:"btn btn-xs btn-default",removeTitle:"Remove file",uploadIcon:'<i class="glyphicon glyphicon-upload text-info"></i>',uploadClass:"btn btn-xs btn-default",uploadTitle:"Upload file",zoomIcon:'<i class="glyphicon glyphicon-zoom-in"></i>',zoomClass:"btn btn-xs btn-default",zoomTitle:"View Details",dragIcon:'<i class="glyphicon glyphicon-menu-hamburger"></i>',dragClass:"text-info",dragTitle:"Move / Rearrange",dragSettings:{},indicatorNew:'<i class="glyphicon glyphicon-hand-down text-warning"></i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign text-success"></i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"></i>',indicatorLoading:'<i class="glyphicon glyphicon-hand-up text-muted"></i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ..."},ba='{preview}\n<div class="kv-upload-progress hide"></div>\n<div class="input-group {class}">\n   {caption}\n   <div class="input-group-btn">\n       {remove}\n       {cancel}\n       {upload}\n       {browse}\n   </div>\n</div>',aU='{preview}\n<div class="kv-upload-progress hide"></div>\n{remove}\n{cancel}\n{upload}\n{browse}\n',bj='<div class="file-preview {class}">\n    {close}    <div class="{dropClass}">\n    <div class="file-preview-thumbnails">\n    </div>\n    <div class="clearfix"></div>    <div class="file-preview-status text-center text-success"></div>\n    <div class="kv-fileinput-error"></div>\n    </div>\n</div>',aC='<div class="close fileinput-remove">&times;</div>\n',bg='<i class="glyphicon glyphicon-file kv-caption-icon"></i>',aT='<div tabindex="500" class="form-control file-caption {class}">\n   <div class="file-caption-name"></div>\n</div>\n',aR='<button type="{type}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}</button>',aj='<a href="{href}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}</a>',ay='<div tabindex="500" class="{css}" {status}>{icon} {label}</div>',az='<div id="'+a9+'" class="file-zoom-dialog modal fade" tabindex="-1" aria-labelledby="'+a9+'Label"></div>',a7='<div class="modal-dialog modal-lg" role="document">\n  <div class="modal-content">\n    <div class="modal-header">\n      <div class="kv-zoom-actions pull-right">{toggleheader}{fullscreen}{borderless}{close}</div>\n      <h3 class="modal-title">{heading} <small><span class="kv-zoom-title"></span></small></h3>\n    </div>\n    <div class="modal-body">\n      <div class="floating-buttons"></div>\n      <div class="kv-zoom-body file-zoom-content"></div>\n{prev} {next}\n    </div>\n  </div>\n</div>\n',aK='<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {percent}%\n     </div>\n</div>',av=" <br><samp>({sizeText})</samp>",ak='<div class="file-thumbnail-footer">\n    <div class="file-footer-caption" title="{caption}">{caption}{size}</div>\n    {progress} {actions}\n</div>',an='<div class="file-actions">\n    <div class="file-footer-buttons">\n        {upload} {delete} {zoom} {other}    </div>\n    {drag}\n    <div class="file-upload-indicator" title="{indicatorTitle}">{indicator}</div>\n    <div class="clearfix"></div>\n</div>',aB='<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}" {dataUrl}{dataKey}>{removeIcon}</button>\n',aQ='<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">{uploadIcon}</button>',aF='<button type="button" class="kv-file-zoom {zoomClass}" title="{zoomTitle}">{zoomIcon}</button>',ai='<span class="file-drag-handle {dragClass}" title="{dragTitle}">{dragIcon}</span>',a8='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}"',ar=a8+'><div class="kv-file-content">\n',ab=a8+' title="{caption}" '+bi+'><div class="kv-file-content">\n',ao="</div>{footer}\n</div>\n",aE="{content}\n",al='<div class="kv-preview-data file-preview-html" title="{caption}" '+bi+">{data}</div>\n",aq='<img src="{data}" class="kv-preview-data file-preview-image" title="{caption}" alt="{caption}" '+bi+">\n",ap='<textarea class="kv-preview-data file-preview-text" title="{caption}" readonly '+bi+">{data}</textarea>\n",aw='<video class="kv-preview-data" width="{width}" height="{height}" controls>\n<source src="{data}" type="{type}">\n'+a0+"\n</video>\n",a1='<audio class="kv-preview-data" controls>\n<source src="{data}" type="{type}">\n'+a0+"\n</audio>\n",ag='<object class="kv-preview-data file-object" type="application/x-shockwave-flash" width="{width}" height="{height}" data="{data}">\n'+a4+" "+a0+"\n</object>\n",ah='<object class="kv-preview-data file-object" data="{data}" type="{type}" width="{width}" height="{height}">\n<param name="movie" value="{caption}" />\n'+a4+" "+a0+"\n</object>\n",at='<embed class="kv-preview-data" src="{data}" width="{width}" height="{height}" type="application/pdf">\n',ax='<div class="kv-preview-data file-preview-other-frame">\n'+a0+"\n</div>\n",ac={main1:ba,main2:aU,preview:bj,close:aC,fileIcon:bg,caption:aT,modalMain:az,modal:a7,progress:aK,size:av,footer:ak,actions:an,actionDelete:aB,actionUpload:aQ,actionZoom:aF,actionDrag:ai,btnDefault:aR,btnLink:aj,btnBrowse:ay},au={generic:ar+aE+ao,html:ar+al+ao,image:ar+aq+ao,text:ar+ap+ao,video:ab+aw+ao,audio:ab+a1+ao,flash:ab+ag+ao,object:ab+ah+ao,pdf:ab+at+ao,other:ab+ax+ao},bh=["image","html","text","video","audio","flash","object"],aN={image:{width:"auto",height:"160px"},html:{width:"213px",height:"160px"},text:{width:"213px",height:"160px"},video:{width:"213px",height:"160px"},audio:{width:"213px",height:"80px"},flash:{width:"213px",height:"160px"},object:{width:"160px",height:"160px"},pdf:{width:"160px",height:"160px"},other:{width:"160px",height:"160px"}},am={image:{width:"auto",height:"100%"},html:{width:"100%",height:"100%","min-height":"480px"},text:{width:"100%",height:"100%","min-height":"480px"},video:{width:"auto",height:"100%","max-width":"100%"},audio:{width:"100%",height:"30px"},flash:{width:"auto",height:"480px"},object:{width:"auto",height:"480px"},pdf:{width:"100%",height:"100%","min-height":"480px"},other:{width:"auto",height:"100%","min-height":"480px"}},aA={image:function(b,a){return a6(b,"image.*")||a6(a,/\.(gif|png|jpe?g)$/i)},html:function(b,a){return a6(b,"text/html")||a6(a,/\.(htm|html)$/i)},text:function(b,a){return a6(b,"text.*")||a6(b,/\.(xml|javascript)$/i)||a6(a,/\.(txt|md|csv|nfo|ini|json|php|js|css)$/i)},video:function(b,a){return a6(b,"video.*")&&(a6(b,/(ogg|mp4|mp?g|webm|3gp)$/i)||a6(a,/\.(og?|mp4|webm|mp?g|3gp)$/i))},audio:function(b,a){return a6(b,"audio.*")&&(a6(b,/(ogg|mp3|mp?g|wav)$/i)||a6(a,/\.(og?|mp3|mp?g|wav)$/i))},flash:function(b,a){return a6(b,"application/x-shockwave-flash",!0)||a6(a,/\.(swf)$/i)},pdf:function(b,a){return a6(b,"application/pdf",!0)||a6(a,/\.(pdf)$/i)},object:function(){return !0},other:function(){return !0}},aa=function(b,a){return void 0===b||null===b||0===b.length||a&&""===bd.trim(b)},aS=function(a){return Array.isArray(a)||"[object Array]"===Object.prototype.toString.call(a)},aP=function(c,b,a){return a=a||"","object"==typeof b&&c in b?b[c]:a},af=function(d,c,b){return aa(d)||aa(d[c])?b:bd(d[c])},aO=function(){return Math.round((new Date).getTime()+100*Math.random())},aJ=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},aD=function(d,c){var b=d;return c?(bd.each(c,function(f,a){"function"==typeof a&&(a=a()),b=b.split(f).join(a)}),b):b},aL=function(b){var a=b.is("img")?b.attr("src"):b.find("source").attr("src");a3.revokeObjectURL(a)},aI=function(b){var a=b.lastIndexOf("/");return -1===a&&(a=b.lastIndexOf("\\")),b.split(b.substring(a,a+1)).pop()},aV=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},aM=function(a){a&&!aV()?document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},aH=function(f,d,c){if(c>=f.length){for(var b=c-f.length;b--+1;){f.push(void 0)}}return f.splice(c,0,f.splice(d,1)[0]),f},aG=function(d,c){var b=this;b.$element=bd(d),b._validate()&&(b.isPreviewable=bc(),b.isIE9=aZ(9),b.isIE10=aZ(10),b.isPreviewable||b.isIE9?(b._init(c),b._listen()):b.$element.removeClass("file-loading"))},aG.prototype={constructor:aG,_init:function(d){var c,b=this,e=b.$element;bd.each(d,function(f,a){switch(f){case"minFileCount":case"maxFileCount":case"maxFileSize":b[f]=aX(a);break;default:b[f]=a}}),aa(b.allowedPreviewTypes)&&(b.allowedPreviewTypes=bh),b.fileInputCleared=!1,b.fileBatchCompleted=!0,b.isPreviewable||(b.showPreview=!1),b.uploadFileAttr=aa(e.attr("name"))?"file_data":e.attr("name"),b.reader=null,b.formdata={},b.clearStack(),b.uploadCount=0,b.uploadStatus={},b.uploadLog=[],b.uploadAsyncCount=0,b.loadedImages=[],b.totalImagesCount=0,b.ajaxRequests=[],b.isError=!1,b.ajaxAborted=!1,b.cancelling=!1,c=b._getLayoutTemplate("progress"),b.progressTemplate=c.replace("{class}",b.progressClass),b.progressCompleteTemplate=c.replace("{class}",b.progressCompleteClass),b.progressErrorTemplate=c.replace("{class}",b.progressErrorClass),b.dropZoneEnabled=a5()&&b.dropZoneEnabled,b.isDisabled=b.$element.attr("disabled")||b.$element.attr("readonly"),b.isUploadable=bb()&&!aa(b.uploadUrl),b.slug="function"==typeof d.slugCallback?d.slugCallback:b._slugDefault,b.mainTemplate=b.showCaption?b._getLayoutTemplate("main1"):b._getLayoutTemplate("main2"),b.captionTemplate=b._getLayoutTemplate("caption"),b.previewGenericTemplate=b._getPreviewTemplate("generic"),b.resizeImage&&(b.maxImageWidth||b.maxImageHeight)&&(b.imageCanvas=document.createElement("canvas"),b.imageCanvasContext=b.imageCanvas.getContext("2d")),aa(b.$element.attr("id"))&&b.$element.attr("id",aO()),void 0===b.$container?b.$container=b._createContainer():b._refreshContainer(),b.$dropZone=b.$container.find(".file-drop-zone"),b.$progress=b.$container.find(".kv-upload-progress"),b.$btnUpload=b.$container.find(".fileinput-upload"),b.$captionContainer=af(d,"elCaptionContainer",b.$container.find(".file-caption")),b.$caption=af(d,"elCaptionText",b.$container.find(".file-caption-name")),b.$previewContainer=af(d,"elPreviewContainer",b.$container.find(".file-preview")),b.$preview=af(d,"elPreviewImage",b.$container.find(".file-preview-thumbnails")),b.$previewStatus=af(d,"elPreviewStatus",b.$container.find(".file-preview-status")),b.$errorContainer=af(d,"elErrorContainer",b.$previewContainer.find(".kv-fileinput-error")),aa(b.msgErrorClass)||aW(b.$errorContainer,b.msgErrorClass),b.$errorContainer.hide(),b.fileActionSettings=bd.extend(!0,ad,d.fileActionSettings),b.previewInitId="preview-"+aO(),b.id=b.$element.attr("id"),a2.init(b),b._initPreview(!0),b._initPreviewActions(),b.options=d,b._setFileDropZoneTitle(),b.$element.removeClass("file-loading"),b.$element.attr("disabled")&&b.disable(),b._initZoom()},_validate:function(){var b,a=this;return"file"===a.$element.attr("type")?!0:(b='<div class="help-block alert alert-warning"><h4>Invalid Input Type</h4>You must set an input <code>type = file</code> for <b>bootstrap-fileinput</b> plugin to initialize.</div>',a.$element.after(b),!1)},_errorsExist:function(){var b,a=this;return a.$errorContainer.find("li").length?!0:(b=bd(document.createElement("div")).html(a.$errorContainer.html()),b.find("span.kv-error-close").remove(),b.find("ul").remove(),!!bd.trim(b.text()).length)},_errorHandler:function(f,d){var c=this,b=f.target.error;b.code===b.NOT_FOUND_ERR?c._showError(c.msgFileNotFound.replace("{name}",d)):b.code===b.SECURITY_ERR?c._showError(c.msgFileSecured.replace("{name}",d)):b.code===b.NOT_READABLE_ERR?c._showError(c.msgFileNotReadable.replace("{name}",d)):b.code===b.ABORT_ERR?c._showError(c.msgFilePreviewAborted.replace("{name}",d)):c._showError(c.msgFilePreviewError.replace("{name}",d))},_addError:function(c){var b=this,a=b.$errorContainer;c&&a.length&&(a.html(b.errorCloseButton+c),bf(a.find(".kv-error-close"),"click",function(){a.fadeOut("slow")}))},_resetErrors:function(c){var b=this,a=b.$errorContainer;b.isError=!1,b.$container.removeClass("has-error"),a.html(""),c?a.fadeOut("slow"):a.hide()},_showFolderError:function(f){var d,c=this,b=c.$errorContainer;f&&(d=c.msgFoldersNotAllowed.replace(/\{n}/g,f),c._addError(d),aW(c.$container,"has-error"),b.fadeIn(800),c._raise("filefoldererror",[f,d]))},_showUploadError:function(g,d,c){var b=this,j=b.$errorContainer,f=c||"fileuploaderror",h=d&&d.id?'<li data-file-id="'+d.id+'">'+g+"</li>":"<li>"+g+"</li>";return 0===j.find("ul").length?b._addError("<ul>"+h+"</ul>"):j.find("ul").append(h),j.fadeIn(800),b._raise(f,[d,g]),b.$container.removeClass("file-input-new"),aW(b.$container,"has-error"),!0},_showError:function(g,d,c){var b=this,h=b.$errorContainer,f=c||"fileerror";return d=d||{},d.reader=b.reader,b._addError(g),h.fadeIn(800),b._raise(f,[d,g]),b.isUploadable||b._clearFileInput(),b.$container.removeClass("file-input-new"),aW(b.$container,"has-error"),b.$btnUpload.attr("disabled",!0),!0},_noFilesError:function(f){var d=this,c=d.minFileCount>1?d.filePlural:d.fileSingle,b=d.msgFilesTooLess.replace("{n}",d.minFileCount).replace("{files}",c),g=d.$errorContainer;d._addError(b),d.isError=!0,d._updateFileDetails(0),g.fadeIn(800),d._raise("fileerror",[f,b]),d._clearFileInput(),aW(d.$container,"has-error")},_parseError:function(e,d,c){var h=this,f=bd.trim(d+""),g="."===f.slice(-1)?"":".",b=void 0!==e.responseJSON&&void 0!==e.responseJSON.error?e.responseJSON.error:e.responseText;return h.cancelling&&h.msgUploadAborted&&(f=h.msgUploadAborted),h.showAjaxErrorDetails&&b?(b=bd.trim(b.replace(/\n\s*\n/g,"\n")),b=b.length>0?"<pre>"+b+"</pre>":"",f+=g+b):f+=g,h.cancelling=!1,c?"<b>"+c+": </b>"+f:f},_parseFileType:function(g){var d,c,b,h,f=this;for(h=0;h<bh.length;h+=1){if(b=bh[h],d=aP(b,f.fileTypeSettings,aA[b]),c=d(g.type,g.name)?b:"",!aa(c)){return c}}return"other"},_parseFilePreviewIcon:function(d,c){var b,f=this,e=f.previewFileIcon;return c&&c.indexOf(".")>-1&&(b=c.split(".").pop(),f.previewFileIconSettings&&f.previewFileIconSettings[b]&&(e=f.previewFileIconSettings[b]),f.previewFileExtSettings&&bd.each(f.previewFileExtSettings,function(g,a){return f.previewFileIconSettings[g]&&a(b)?void (e=f.previewFileIconSettings[g]):void 0})),d.indexOf("{previewFileIcon}")>-1?d.replace(/\{previewFileIconClass}/g,f.previewFileIconClass).replace(/\{previewFileIcon}/g,e):d},_raise:function(d,c){var b=this,e=bd.Event(d);if(void 0!==c?b.$element.trigger(e,c):b.$element.trigger(e),e.isDefaultPrevented()){return !1}if(!e.result){return e.result}switch(d){case"filebatchuploadcomplete":case"filebatchuploadsuccess":case"fileuploaded":case"fileclear":case"filecleared":case"filereset":case"fileerror":case"filefoldererror":case"fileuploaderror":case"filebatchuploaderror":case"filedeleteerror":case"filecustomerror":case"filesuccessremove":break;default:b.ajaxAborted=e.result}return !0},_listenFullScreen:function(f){var d,c,b=this,g=b.$modal;g&&g.length&&(d=g&&g.find(".btn-fullscreen"),c=g&&g.find(".btn-borderless"),d.length&&c.length&&(d.removeClass("active").attr("aria-pressed","false"),c.removeClass("active").attr("aria-pressed","false"),f?d.addClass("active").attr("aria-pressed","true"):c.addClass("active").attr("aria-pressed","true"),g.hasClass("file-zoom-fullscreen")?b._maximizeZoomDialog():f?b._maximizeZoomDialog():c.removeClass("active").attr("aria-pressed","false")))},_listen:function(){var d=this,c=d.$element,b=c.closest("form"),e=d.$container;bf(c,"change",bd.proxy(d._change,d)),bf(d.$btnFile,"click",bd.proxy(d._browse,d)),bf(b,"reset",bd.proxy(d.reset,d)),bf(e.find(".fileinput-remove:not([disabled])"),"click",bd.proxy(d.clear,d)),bf(e.find(".fileinput-cancel"),"click",bd.proxy(d.cancel,d)),d._initDragDrop(),d.isUploadable||bf(b,"submit",bd.proxy(d._submitForm,d)),bf(d.$container.find(".fileinput-upload"),"click",bd.proxy(d._uploadClick,d)),bf(bd(window),"resize",function(){d._listenFullScreen(screen.width===window.innerWidth&&screen.height===window.innerHeight)}),bf(bd(document),"webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",function(){d._listenFullScreen(aV())})},_initDragDrop:function(){var b=this,a=b.$dropZone;b.isUploadable&&b.dropZoneEnabled&&b.showPreview&&(bf(a,"dragenter dragover",bd.proxy(b._zoneDragEnter,b)),bf(a,"dragleave",bd.proxy(b._zoneDragLeave,b)),bf(a,"drop",bd.proxy(b._zoneDrop,b)),bf(bd(document),"dragenter dragover drop",b._zoneDragDropInit))},_zoneDragDropInit:function(a){a.stopPropagation(),a.preventDefault()},_zoneDragEnter:function(d){var c=this,b=bd.inArray("Files",d.originalEvent.dataTransfer.types)>-1;return c._zoneDragDropInit(d),c.isDisabled||!b?(d.originalEvent.dataTransfer.effectAllowed="none",void (d.originalEvent.dataTransfer.dropEffect="none")):void aW(c.$dropZone,"file-highlighted")},_zoneDragLeave:function(b){var a=this;a._zoneDragDropInit(b),a.isDisabled||a.$dropZone.removeClass("file-highlighted")},_zoneDrop:function(b){var a=this;b.preventDefault(),a.isDisabled||aa(b.originalEvent.dataTransfer.files)||(a._change(b,"dragdrop"),a.$dropZone.removeClass("file-highlighted"))},_uploadClick:function(f){var d,c=this,b=c.$container.find(".fileinput-upload"),g=!b.hasClass("disabled")&&aa(b.attr("disabled"));if(!f||!f.isDefaultPrevented()){if(!c.isUploadable){return void (g&&"submit"!==b.attr("type")&&(d=b.closest("form"),d.length&&d.trigger("submit"),f.preventDefault()))}f.preventDefault(),g&&c.upload()}},_submitForm:function(){var c=this,b=c.$element,a=b.get(0).files;return a&&c.minFileCount>0&&c._getFileCount(a.length)<c.minFileCount?(c._noFilesError({}),!1):!c._abort({})},_clearPreview:function(){var b=this,a=b.showUploadedThumbs?b.$preview.find(".file-preview-frame:not(.file-preview-success)"):b.$preview.find(".file-preview-frame");a.remove(),b.$preview.find(".file-preview-frame").length&&b.showPreview||b._resetUpload(),b._validateDefaultPreview()},_initSortable:function(){var d,c,b=this,e=b.$preview;window.Sortable&&(d=e.find(".file-initial-thumbs"),c={handle:".drag-handle-init",dataIdAttr:"data-preview-id",onSort:function(f){var a=f.oldIndex,g=f.newIndex;b.initialPreview=aH(b.initialPreview,a,g),b.initialPreviewConfig=aH(b.initialPreviewConfig,a,g),a2.init(b),b._raise("filesorted",{previewId:bd(f.item).attr("id"),oldIndex:a,newIndex:g,stack:b.initialPreviewConfig})}},d.data("sortable")&&d.sortable("destroy"),bd.extend(!0,c,b.fileActionSettings.dragSettings),d.sortable(c))},_initPreview:function(f){var d,c=this,b=c.initialCaption||"";return a2.count(c.id)?(d=a2.out(c.id),b=f&&c.initialCaption?c.initialCaption:d.caption,c.$preview.html(d.content),c._setCaption(b),c._initSortable(),void (aa(d.content)||c.$container.removeClass("file-input-new"))):(c._clearPreview(),void (f?c._setCaption(b):c._initCaption()))},_getZoomButton:function(g){var d=this,c=d.previewZoomButtonIcons[g],b=d.previewZoomButtonClasses[g],h=' title="'+(d.previewZoomButtonTitles[g]||"")+'" ',f=h+("close"===g?' data-dismiss="modal" aria-hidden="true"':"");return"fullscreen"!==g&&"borderless"!==g&&"toggleheader"!==g||(f+=' data-toggle="button" aria-pressed="false" autocomplete="off"'),'<button type="button" class="'+b+" btn-"+g+'"'+f+">"+c+"</button>"},_getModalContent:function(){var a=this;return a._getLayoutTemplate("modal").replace(/\{heading}/g,a.msgZoomModalHeading).replace(/\{prev}/g,a._getZoomButton("prev")).replace(/\{next}/g,a._getZoomButton("next")).replace(/\{toggleheader}/g,a._getZoomButton("toggleheader")).replace(/\{fullscreen}/g,a._getZoomButton("fullscreen")).replace(/\{borderless}/g,a._getZoomButton("borderless")).replace(/\{close}/g,a._getZoomButton("close"))},_listenModalEvent:function(f){var d=this,c=d.$modal,b=function(a){return{sourceEvent:a,previewId:c.data("previewId"),modal:c}};c.on(f+".bs.modal",function(g){var a=c.find(".btn-fullscreen"),e=c.find(".btn-borderless");d._raise("filezoom"+f,b(g)),"shown"===f&&(e.removeClass("active").attr("aria-pressed","false"),a.removeClass("active").attr("aria-pressed","false"),c.hasClass("file-zoom-fullscreen")&&(d._maximizeZoomDialog(),aV()?a.addClass("active").attr("aria-pressed","true"):e.addClass("active").attr("aria-pressed","true")))})},_initZoom:function(){var c,b=this,e=b._getLayoutTemplate("modalMain"),d="#"+a9;b.$modal=bd(d),b.$modal&&b.$modal.length||(c=bd(document.createElement("div")).html(e).appendTo(bd(document.body)),b.$modal=bd("#"+a9).insertBefore(c),c.remove()),b.$modal.html(b._getModalContent()),b._listenModalEvent("show"),b._listenModalEvent("shown"),b._listenModalEvent("hide"),b._listenModalEvent("hidden"),b._listenModalEvent("loaded")},_initZoomButtons:function(){var e,d,c=this,j=c.$modal.data("previewId")||"",g=c.$preview.find(".file-preview-frame").toArray(),h=g.length,b=c.$modal.find(".btn-prev"),f=c.$modal.find(".btn-next");h&&(e=bd(g[0]),d=bd(g[h-1]),b.removeAttr("disabled"),f.removeAttr("disabled"),e.length&&e.attr("id")===j&&b.attr("disabled",!0),d.length&&d.attr("id")===j&&f.attr("disabled",!0))},_maximizeZoomDialog:function(){var e=this,d=e.$modal,c=d.find(".modal-header:visible"),h=d.find(".modal-footer:visible"),f=d.find(".modal-body"),g=bd(window).height(),b=0;d.addClass("file-zoom-fullscreen"),c&&c.length&&(g-=c.outerHeight(!0)),h&&h.length&&(g-=h.outerHeight(!0)),f&&f.length&&(b=f.outerHeight(!0)-f.height(),g-=b),d.find(".kv-zoom-body").height(g)},_resizeZoomDialog:function(f){var d=this,c=d.$modal,b=c.find(".btn-fullscreen"),g=c.find(".btn-borderless");if(c.hasClass("file-zoom-fullscreen")){aM(!1),f?b.hasClass("active")||(c.removeClass("file-zoom-fullscreen"),d._resizeZoomDialog(!0),g.hasClass("active")&&g.removeClass("active").attr("aria-pressed","false")):b.hasClass("active")?b.removeClass("active").attr("aria-pressed","false"):(c.removeClass("file-zoom-fullscreen"),d.$modal.find(".kv-zoom-body").css("height",d.zoomModalHeight))}else{if(!f){return void d._maximizeZoomDialog()}aM(!0)}c.focus()},_setZoomContent:function(j,B){var H,y,q,x,A,k,F,v,e=this,E=j.attr("id"),z=e.$modal,D=z.find(".btn-prev"),C=z.find(".btn-next"),c=z.find(".btn-fullscreen"),I=z.find(".btn-borderless"),G=z.find(".btn-toggleheader");y=j.data("template")||"generic",H=j.find(".kv-file-content"),q=H.length?H.html():"",x=j.find(".file-footer-caption").text()||"",z.find(".kv-zoom-title").html(x),A=z.find(".kv-zoom-body"),B?(v=A.clone().insertAfter(A),A.html(q).hide(),v.fadeOut("fast",function(){A.fadeIn("fast"),v.remove()})):A.html(q),F=e.previewZoomSettings[y],F&&(k=A.find(".kv-preview-data"),aW(k,"file-zoom-detail"),bd.each(F,function(b,a){k.css(b,a),(k.attr("width")&&"width"===b||k.attr("height")&&"height"===b)&&k.removeAttr(b)})),z.data("previewId",E),bf(D,"click",function(){e._zoomSlideShow("prev",E)}),bf(C,"click",function(){e._zoomSlideShow("next",E)}),bf(c,"click",function(){e._resizeZoomDialog(!0)}),bf(I,"click",function(){e._resizeZoomDialog(!1)}),bf(G,"click",function(){var g,f=z.find(".modal-header"),d=z.find(".modal-body .floating-buttons"),b=f.find(".kv-zoom-actions"),h=function(n){var m=e.$modal.find(".kv-zoom-body"),l=e.zoomModalHeight;z.hasClass("file-zoom-fullscreen")&&(l=m.outerHeight(!0),n||(l-=f.outerHeight(!0))),m.css("height",n?l+n:l)};f.is(":visible")?(g=f.outerHeight(!0),f.slideUp("slow",function(){b.find(".btn").appendTo(d),h(g)})):(d.find(".btn").appendTo(b),f.slideDown("slow",function(){h()})),z.focus()}),bf(z,"keydown",function(b){var a=b.which||b.keyCode;37!==a||D.attr("disabled")||e._zoomSlideShow("prev",E),39!==a||C.attr("disabled")||e._zoomSlideShow("next",E)})},_zoomPreview:function(c){var b,a=this;if(!c.length){throw"Cannot zoom to detailed preview!"}a.$modal.html(a._getModalContent()),b=c.closest(".file-preview-frame"),a._setZoomContent(b),a.$modal.modal("show"),a._initZoomButtons()},_zoomSlideShow:function(k,g){var j,e,b,c=this,f=c.$modal.find(".kv-zoom-actions .btn-"+k),m=c.$preview.find(".file-preview-frame").toArray(),h=m.length;if(!f.attr("disabled")){for(e=0;h>e;e++){if(bd(m[e]).attr("id")===g){b="prev"===k?e-1:e+1;break}}0>b||b>=h||!m[b]||(j=bd(m[b]),j.length&&c._setZoomContent(j,!0),c._initZoomButtons(),c._raise("filezoom"+k,{previewId:g,modal:c.$modal}))}},_initZoomButton:function(){var a=this;a.$preview.find(".kv-file-zoom").each(function(){var b=bd(this);bf(b,"click",function(){a._zoomPreview(b)})})},_initPreviewActions:function(){var d=this,c=d.deleteExtraData||{},b=function(){var a=d.isUploadable?a2.count(d.id):d.$element.get(0).files.length;0!==d.$preview.find(".kv-file-remove").length||a||(d.reset(),d.initialCaption="")};d._initZoomButton(),d.$preview.find(".kv-file-remove").each(function(){var h=bd(this),a=h.data("url")||d.deleteUrl,e=h.data("key");if(!aa(a)&&void 0!==e){var j,v,q,t,p=h.closest(".file-preview-frame"),i=a2.data[d.id],k=p.data("fileindex");k=parseInt(k.replace("init_","")),q=aa(i.config)&&aa(i.config[k])?null:i.config[k],t=aa(q)||aa(q.extra)?c:q.extra,"function"==typeof t&&(t=t()),v={id:h.attr("id"),key:e,extra:t},j=bd.extend(!0,{},{url:a,type:"POST",dataType:"json",data:bd.extend(!0,{},{key:e},t),beforeSend:function(f){d.ajaxAborted=!1,d._raise("filepredelete",[e,f,t]),d.ajaxAborted?f.abort():(aW(p,"file-uploading"),aW(h,"disabled"))},success:function(n,g,m){var f,o;return aa(n)||aa(n.error)?(a2.unset(d.id,k),f=a2.count(d.id),o=f>0?d._getMsgSelected(f):"",d._raise("filedeleted",[e,m,t]),d._setCaption(o),p.removeClass("file-uploading").addClass("file-deleted"),void p.fadeOut("slow",function(){d._clearObjects(p),p.remove(),b(),f||0!==d.getFileStack().length||(d._setCaption(""),d.reset())})):(v.jqXHR=m,v.response=n,d._showError(n.error,v,"filedeleteerror"),p.removeClass("file-uploading"),h.removeClass("disabled"),void b())},error:function(l,f,m){var g=d._parseError(l,m);v.jqXHR=l,v.response={},d._showError(g,v,"filedeleteerror"),p.removeClass("file-uploading"),b()}},d.ajaxDeleteSettings),bf(h,"click",function(){return d._validateMinCount()?void bd.ajax(j):!1})}})},_clearObjects:function(a){a.find("video audio").each(function(){this.pause(),bd(this).remove()}),a.find("img object div").each(function(){bd(this).remove()})},_clearFileInput:function(){var d,c,b,f=this,e=f.$element;aa(e.val())||(f.isIE9||f.isIE10?(d=e.closest("form"),c=bd(document.createElement("form")),b=bd(document.createElement("div")),e.before(b),d.length?d.after(c):b.after(c),c.append(e).trigger("reset"),b.before(e).remove(),c.remove()):e.val(""),f.fileInputCleared=!0)},_resetUpload:function(){var a=this;a.uploadCache={content:[],config:[],tags:[],append:!0},a.uploadCount=0,a.uploadStatus={},a.uploadLog=[],a.uploadAsyncCount=0,a.loadedImages=[],a.totalImagesCount=0,a.$btnUpload.removeAttr("disabled"),a._setProgress(0),aW(a.$progress,"hide"),a._resetErrors(!1),a.ajaxAborted=!1,a.ajaxRequests=[],a._resetCanvas()},_resetCanvas:function(){var a=this;a.canvas&&a.imageCanvasContext&&a.imageCanvasContext.clearRect(0,0,a.canvas.width,a.canvas.height)},_hasInitialPreview:function(){var a=this;return !a.overwriteInitial&&a2.count(a.id)},_resetPreview:function(){var c,b,a=this;a2.count(a.id)?(c=a2.out(a.id),a.$preview.html(c.content),b=a.initialCaption?a.initialCaption:c.caption,a._setCaption(b)):(a._clearPreview(),a._initCaption()),a.showPreview&&(a._initZoom(),a._initSortable())},_clearDefaultPreview:function(){var a=this;a.$preview.find(".file-default-preview").remove()},_validateDefaultPreview:function(){var a=this;a.showPreview&&!aa(a.defaultPreviewContent)&&(a.$preview.html('<div class="file-default-preview">'+a.defaultPreviewContent+"</div>"),a.$container.removeClass("file-input-new"))},_resetPreviewThumbs:function(c){var b,a=this;return c?(a._clearPreview(),void a.clearStack()):void (a._hasInitialPreview()?(b=a2.out(a.id),a.$preview.html(b.content),a._setCaption(b.caption),a._initPreviewActions()):a._clearPreview())},_getLayoutTemplate:function(c){var b=this,a=aP(c,b.layoutTemplates,ac[c]);return aa(b.customLayoutTags)?a:aD(a,b.customLayoutTags)},_getPreviewTemplate:function(c){var b=this,a=aP(c,b.previewTemplates,au[c]);return aa(b.customPreviewTags)?a:aD(a,b.customPreviewTags)},_getOutData:function(f,d,c){var b=this;return f=f||{},d=d||{},c=c||b.filestack.slice(0)||{},{form:b.formdata,files:c,filenames:b.filenames,extra:b._getExtraData(),response:d,reader:b.reader,jqXHR:f}},_getMsgSelected:function(c){var b=this,a=1===c?b.fileSingle:b.filePlural;return b.msgSelected.replace("{n}",c).replace("{files}",a)},_getThumbs:function(a){return a=a||"",this.$preview.find(".file-preview-frame:not(.file-preview-initial)"+a)},_getExtraData:function(f,d){var c=this,b=c.uploadExtraData;return"function"==typeof c.uploadExtraData&&(b=c.uploadExtraData(f,d)),b},_initXhr:function(f,d,c){var b=this;return f.upload&&f.upload.addEventListener("progress",function(g){var i=0,a=g.loaded||g.position,h=g.total;g.lengthComputable&&(i=Math.ceil(a/h*100)),d?b._setAsyncUploadStatus(d,i,c):b._setProgress(Math.ceil(i))},!1),f},_ajaxSubmit:function(e,d,c,j,g,h){var b,f=this;f._raise("filepreajax",[g,h]),f._uploadExtra(g,h),b=bd.extend(!0,{},{xhr:function(){var a=bd.ajaxSettings.xhr();return f._initXhr(a,g,f.getFileStack().length)},url:f.uploadUrl,type:"POST",dataType:"json",data:f.formdata,cache:!1,processData:!1,contentType:!1,beforeSend:e,success:d,complete:c,error:j},f.ajaxSettings),f.ajaxRequests.push(bd.ajax(b))},_initUploadSuccess:function(w,j,q){var g,b,e,h,x,m,p,v,k=this;k.showPreview&&"object"==typeof w&&!bd.isEmptyObject(w)&&void 0!==w.initialPreview&&w.initialPreview.length>0&&(k.hasInitData=!0,x=w.initialPreview||[],m=w.initialPreviewConfig||[],p=w.initialPreviewThumbTags||[],g=!(void 0!==w.append&&!w.append),x.length>0&&!aS(x)&&(x=x.split(k.initialPreviewDelimiter)),k.overwriteInitial=!1,k.initialPreview.concat(x),k.initialPreviewThumbTags.concat(p),k.initialPreviewConfig.concat(m),void 0!==j?q?(v=j.attr("data-fileindex"),k.uploadCache.content[v]=x[0],k.uploadCache.config[v]=m[0],k.uploadCache.tags[v]=p[0],k.uploadCache.append=g):(e=a2.add(k.id,x,m[0],p[0],g),b=a2.get(k.id,e,!1),h=bd(b).hide(),j.after(h).fadeOut("slow",function(){h.fadeIn("slow").css("display:inline-block"),k._initPreviewActions(),k._clearFileInput(),j.remove()})):(a2.set(k.id,x,m,p,g),k._initPreview(),k._initPreviewActions()))},_initSuccessThumbs:function(){var a=this;a.showPreview&&a._getThumbs(".file-preview-success").each(function(){var c=bd(this),b=c.find(".kv-file-remove");b.removeAttr("disabled"),bf(b,"click",function(){var d=a._raise("filesuccessremove",[c.attr("id"),c.data("fileindex")]);aL(c),d!==!1&&c.fadeOut("slow",function(){c.remove(),a.$preview.find(".file-preview-frame").length||a.reset()})})})},_checkAsyncComplete:function(){var d,c,b=this;for(c=0;c<b.filestack.length;c++){if(b.filestack[c]&&(d=b.previewInitId+"-"+c,-1===bd.inArray(d,b.uploadLog))){return !1}}return b.uploadAsyncCount===b.uploadLog.length},_uploadExtra:function(d,c){var b=this,e=b._getExtraData(d,c);0!==e.length&&bd.each(e,function(f,a){b.formdata.append(f,a)})},_uploadSingle:function(k,B,J){var y,v,x,A,p,G,H,j,F,z,E=this,D=E.getFileStack().length,e=new FormData,K=E.previewInitId+"-"+k,I=E.filestack.length>0||!bd.isEmptyObject(E.uploadExtraData),q={id:K,index:k};E.formdata=e,E.showPreview&&(v=bd("#"+K+":not(.file-preview-initial)"),A=v.find(".kv-file-upload"),p=v.find(".kv-file-remove"),bd("#"+K).find(".file-thumb-progress").removeClass("hide")),0===D||!I||A&&A.hasClass("disabled")||E._abort(q)||(z=function(b,a){E.updateStack(b,void 0),E.uploadLog.push(a),E._checkAsyncComplete()&&(E.fileBatchCompleted=!0)},x=function(){var a=E.uploadCache;E.fileBatchCompleted&&setTimeout(function(){E.showPreview&&(a2.set(E.id,a.content,a.config,a.tags,a.append),E.hasInitData&&(E._initPreview(),E._initPreviewActions())),E.unlock(),E._clearFileInput(),E._raise("filebatchuploadcomplete",[E.filestack,E._getExtraData()]),E.uploadCount=0,E.uploadStatus={},E.uploadLog=[],E._setProgress(100)},100)},G=function(a){y=E._getOutData(a),E.fileBatchCompleted=!1,E.showPreview&&(v.hasClass("file-preview-success")||(E._setThumbStatus(v,"Loading"),aW(v,"file-uploading")),A.attr("disabled",!0),p.attr("disabled",!0)),J||E.lock(),E._raise("filepreupload",[y,K,k]),bd.extend(!0,q,y),E._abort(q)&&(a.abort(),E._setProgressCancelled())},H=function(a,c,b){y=E._getOutData(b,a),bd.extend(!0,q,y),setTimeout(function(){aa(a)||aa(a.error)?(E.showPreview&&(E._setThumbStatus(v,"Success"),A.hide(),E._initUploadSuccess(a,v,J)),E._raise("fileuploaded",[y,K,k]),J?z(k,K):E.updateStack(k,void 0)):(E._showUploadError(a.error,q),E._setPreviewError(v,k),J&&z(k,K))},100)},j=function(){setTimeout(function(){E.showPreview&&(A.removeAttr("disabled"),p.removeAttr("disabled"),v.removeClass("file-uploading")),J?x():(E.unlock(!1),E._clearFileInput()),E._initSuccessThumbs()},100)},F=function(d,c,a){var b=E._parseError(d,a,J?B[k].name:null);setTimeout(function(){J&&z(k,K),E.uploadStatus[K]=100,E._setPreviewError(v,k),bd.extend(!0,q,E._getOutData(d)),E._showUploadError(b,q)},100)},e.append(E.uploadFileAttr,B[k],E.filenames[k]),e.append("file_id",k),E._ajaxSubmit(G,H,j,F,K,k))},_uploadBatch:function(){var p,h,m,f,b,e=this,g=e.filestack,q=g.length,j={},k=e.filestack.length>0||!bd.isEmptyObject(e.uploadExtraData);e.formdata=new FormData,0!==q&&k&&!e._abort(j)&&(b=function(){bd.each(g,function(a){e.updateStack(a,void 0)}),e._clearFileInput()},p=function(c){e.lock();var a=e._getOutData(c);e.showPreview&&e._getThumbs().each(function(){var n=bd(this),l=n.find(".kv-file-upload"),d=n.find(".kv-file-remove");n.hasClass("file-preview-success")||(e._setThumbStatus(n,"Loading"),aW(n,"file-uploading")),l.attr("disabled",!0),d.attr("disabled",!0)}),e._raise("filebatchpreupload",[a]),e._abort(a)&&(c.abort(),e._setProgressCancelled())},h=function(u,r,o){var x=e._getOutData(o,u),c=e._getThumbs(),v=0,w=aa(u)||aa(u.errorkeys)?[]:u.errorkeys;aa(u)||aa(u.error)?(e._raise("filebatchuploadsuccess",[x]),b(),e.showPreview?(c.each(function(){var d=bd(this),a=d.find(".kv-file-upload");d.find(".kv-file-upload").hide(),e._setThumbStatus(d,"Success"),d.removeClass("file-uploading"),a.removeAttr("disabled")}),e._initUploadSuccess(u)):e.reset()):(e.showPreview&&(c.each(function(){var n=bd(this),l=n.find(".kv-file-remove"),d=n.find(".kv-file-upload");return n.removeClass("file-uploading"),d.removeAttr("disabled"),l.removeAttr("disabled"),0===w.length?void e._setPreviewError(n):(-1!==bd.inArray(v,w)?e._setPreviewError(n):(n.find(".kv-file-upload").hide(),e._setThumbStatus(n,"Success"),e.updateStack(v,void 0)),void v++)}),e._initUploadSuccess(u)),e._showUploadError(u.error,x,"filebatchuploaderror"))},f=function(){e._setProgress(100),e.unlock(),e._initSuccessThumbs(),e._clearFileInput(),e._raise("filebatchuploadcomplete",[e.filestack,e._getExtraData()])},m=function(l,d,c){var s=e._getOutData(l),o=e._parseError(l,c);e._showUploadError(o,s,"filebatchuploaderror"),e.uploadFileCount=q-1,e.showPreview&&(e._getThumbs().each(function(){var n=bd(this),a=n.attr("data-fileindex");n.removeClass("file-uploading"),void 0!==e.filestack[a]&&e._setPreviewError(n)}),e._getThumbs().removeClass("file-uploading"),e._getThumbs(" .kv-file-upload").removeAttr("disabled"),e._getThumbs(" .kv-file-delete").removeAttr("disabled"))},bd.each(g,function(c,a){aa(g[c])||e.formdata.append(e.uploadFileAttr,a,e.filenames[c])}),e._ajaxSubmit(p,h,f,m))},_uploadExtraOnly:function(){var g,d,c,b,h=this,f={};h.formdata=new FormData,h._abort(f)||(g=function(i){h.lock();var a=h._getOutData(i);h._raise("filebatchpreupload",[a]),h._setProgress(50),f.data=a,f.xhr=i,h._abort(f)&&(i.abort(),h._setProgressCancelled())},d=function(m,l,k){var j=h._getOutData(k,m);aa(m)||aa(m.error)?(h._raise("filebatchuploadsuccess",[j]),h._clearFileInput(),h._initUploadSuccess(m)):h._showUploadError(m.error,j,"filebatchuploaderror")},c=function(){h._setProgress(100),h.unlock(),h._clearFileInput(),h._raise("filebatchuploadcomplete",[h.filestack,h._getExtraData()])},b=function(m,l,k){var j=h._getOutData(m),n=h._parseError(m,k);f.data=j,h._showUploadError(n,j,"filebatchuploaderror")},h._ajaxSubmit(g,d,c,b))},_initFileActions:function(){var a=this;a.showPreview&&(a._initZoomButton(),a.$preview.find(".kv-file-remove").each(function(){var e,c,k,g,j=bd(this),b=j.closest(".file-preview-frame"),f=b.attr("id"),h=b.attr("data-fileindex");bf(j,"click",function(){return g=a._raise("filepreremove",[f,h]),g!==!1&&a._validateMinCount()?(e=b.hasClass("file-preview-error"),aL(b),void b.fadeOut("slow",function(){a.updateStack(h,void 0),a._clearObjects(b),b.remove(),f&&e&&a.$errorContainer.find('li[data-file-id="'+f+'"]').fadeOut("fast",function(){bd(this).remove(),a._errorsExist()||a._resetErrors()});var i=a.getFileStack(!0),l=i.length,m=a2.count(a.id),d=a.showPreview&&a.$preview.find(".file-preview-frame").length;a._clearFileInput(),0!==l||0!==m||d?(c=m+l,k=c>1?a._getMsgSelected(c):i[0]?a._getFileNames()[0]:"",a._setCaption(k)):a.reset(),a._raise("fileremoved",[f,h])})):!1})}),a.$preview.find(".kv-file-upload").each(function(){var b=bd(this);bf(b,"click",function(){var d=b.closest(".file-preview-frame"),c=d.attr("data-fileindex");d.hasClass("file-preview-error")||a._uploadSingle(c,a.filestack,!1)})}))},_hideFileIcon:function(){this.overwriteInitial&&this.$captionContainer.find(".kv-caption-icon").hide()},_showFileIcon:function(){this.$captionContainer.find(".kv-caption-icon").show()},_getSize:function(h){var f=parseFloat(h);if(null===h||isNaN(f)){return""}var d,c,k,g=this,j=g._getLayoutTemplate("size"),b=g.fileSizeGetter;return"function"==typeof b?k=b(h):(d=Math.floor(Math.log(f)/Math.log(1024)),c=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],k=1*(f/Math.pow(1024,d)).toFixed(2)+" "+c[d]),j.replace("{sizeText}",k)},_generatePreviewTemplate:function(G,k,C,J,z,w,y,B,q,H){var I,x,j=this,F=j._getPreviewTemplate(G),A=B||"",E=aP(G,j.previewSettings,aN[G]),b=j.slug(C),D=q||j._renderFileFooter(b,y,E.width,w);return H=H||z.slice(z.lastIndexOf("-")+1),F=j._parseFilePreviewIcon(F,C),"text"===G||"html"===G?(x="text"===G?aJ(k):k,I=F.replace(/\{previewId}/g,z).replace(/\{caption}/g,b).replace(/\{width}/g,E.width).replace(/\{height}/g,E.height).replace(/\{frameClass}/g,A).replace(/\{cat}/g,J).replace(/\{footer}/g,D).replace(/\{fileindex}/g,H).replace(/\{data}/g,x).replace(/\{template}/g,G)):I=F.replace(/\{previewId}/g,z).replace(/\{caption}/g,b).replace(/\{frameClass}/g,A).replace(/\{type}/g,J).replace(/\{fileindex}/g,H).replace(/\{width}/g,E.width).replace(/\{height}/g,E.height).replace(/\{footer}/g,D).replace(/\{data}/g,k).replace(/\{template}/g,G),I},_previewDefault:function(q,h,m){var f=this,b=f.$preview,g=b.find(".file-live-thumbs");if(f.showPreview){var v,j=q?q.name:"",k=q?q.type:"",e=m===!0&&!f.isUploadable,o=a3.createObjectURL(q);f._clearDefaultPreview(),v=f._generatePreviewTemplate("other",o,j,k,h,e,q.size),g.length||(g=bd(document.createElement("div")).addClass("file-live-thumbs").appendTo(b)),g.append("\n"+v),m===!0&&f.isUploadable&&f._setThumbStatus(bd("#"+h),"Error")}},_previewFile:function(G,x,D,k,b){if(this.showPreview){var j,w=this,H=w._parseFileType(x),B=x?x.name:"",C=w.slug(B),e=w.allowedPreviewTypes,F=w.allowedPreviewMimeTypes,A=w.$preview,q=e&&e.indexOf(H)>=0,z=A.find(".file-live-thumbs"),E="text"===H||"html"===H||"image"===H?D.target.result:b,y=F&&-1!==F.indexOf(x.type);z.length||(z=bd(document.createElement("div")).addClass("file-live-thumbs").appendTo(A)),"html"===H&&w.purifyHtml&&window.DOMPurify&&(E=window.DOMPurify.sanitize(E)),q||y?(j=w._generatePreviewTemplate(H,E,B,x.type,k,!1,x.size),w._clearDefaultPreview(),z.append("\n"+j),w._validateImage(G,k,C,x.type)):w._previewDefault(x,k),w._initSortable()}},_slugDefault:function(a){return aa(a)?"":String(a).replace(/[\-\[\]\/\{}:;#%=\(\)\*\+\?\\\^\$\|<>&"']/g,"_")},_readFiles:function(F){this.reader=new FileReader;var l,A=this,j=A.$element,b=A.$preview,G=A.reader,y=A.$previewContainer,z=A.$previewStatus,e=A.msgLoading,E=A.msgProgress,x=A.previewInitId,k=F.length,q=A.fileTypeSettings,D=A.filestack.length,o=A.maxFilePreviewSize&&parseFloat(A.maxFilePreviewSize),B=b.length&&(!o||isNaN(o)),C=function(i,f,h,a){var c=bd.extend(!0,{},A._getOutData({},{},F),{id:h,index:a}),g={id:h,index:a,file:f,files:F};return A._previewDefault(f,h,!0),A.isUploadable&&A.addToStack(void 0),setTimeout(function(){l(a+1)},100),A._initFileActions(),A.removeFromPreviewOnError&&bd("#"+h).remove(),A.isUploadable?A._showUploadError(i,c):A._showError(i,g)};A.loadedImages=[],A.totalImagesCount=0,bd.each(F,function(d,c){var a=A.fileTypeSettings.image||aA.image;a&&a(c.type)&&A.totalImagesCount++}),l=function(K){if(aa(j.attr("multiple"))&&(k=1),K>=k){return A.isUploadable&&A.filestack.length>0?A._raise("filebatchselected",[A.getFileStack()]):A._raise("filebatchselected",[F]),y.removeClass("file-thumb-loading"),void z.html("")}var M,v,p,n,d,s,t,H=D+K,g=x+"-"+H,r=F[K],f=A.slug(r.name),h=(r.size||0)/1000,u="",m=a3.createObjectURL(r),w=0,c=A.allowedFileTypes,J=aa(c)?"":c.join(", "),i=A.allowedFileExtensions,a=aa(i)?"":i.join(", ");if(aa(i)||(u=new RegExp("\\.("+i.join("|")+")$","i")),h=h.toFixed(2),A.maxFileSize>0&&h>A.maxFileSize){return d=A.msgSizeTooLarge.replace("{name}",f).replace("{size}",h).replace("{maxSize}",A.maxFileSize),void (A.isError=C(d,r,g,K))}if(!aa(c)&&aS(c)){for(n=0;n<c.length;n+=1){s=c[n],p=q[s],t=void 0!==p&&p(r.type,f),w+=aa(t)?0:t.length}if(0===w){return d=A.msgInvalidFileType.replace("{name}",f).replace("{types}",J),void (A.isError=C(d,r,g,K))}}return 0!==w||aa(i)||!aS(i)||aa(u)||(t=a6(f,u),w+=aa(t)?0:t.length,0!==w)?A.showPreview?!B&&h>o?(y.addClass("file-thumb-loading"),A._previewDefault(r,g),A._initFileActions(),A._updateFileDetails(k),void l(K+1)):(b.length&&void 0!==FileReader?(z.html(e.replace("{index}",K+1).replace("{files}",k)),y.addClass("file-thumb-loading"),G.onerror=function(I){A._errorHandler(I,f)},G.onload=function(I){A._previewFile(K,r,I,g,m),A._initFileActions()},G.onloadend=function(){d=E.replace("{index}",K+1).replace("{files}",k).replace("{percent}",50).replace("{name}",f),setTimeout(function(){z.html(d),A._updateFileDetails(k),l(K+1)},100),A._raise("fileloaded",[r,g,K,G])},G.onprogress=function(N){if(N.lengthComputable){var L=N.loaded/N.total*100,I=Math.ceil(L);d=E.replace("{index}",K+1).replace("{files}",k).replace("{percent}",I).replace("{name}",f),setTimeout(function(){z.html(d)},100)}},M=aP("text",q,aA.text),v=aP("image",q,aA.image),M(r.type,f)?G.readAsText(r,A.textEncoding):v(r.type,f)?G.readAsDataURL(r):G.readAsArrayBuffer(r)):(A._previewDefault(r,g),setTimeout(function(){l(K+1),A._updateFileDetails(k)},100),A._raise("fileloaded",[r,g,K,G])),void A.addToStack(r)):(A.addToStack(r),setTimeout(function(){l(K+1)},100),void A._raise("fileloaded",[r,g,K,G])):(d=A.msgInvalidFileExtension.replace("{name}",f).replace("{extensions}",a),void (A.isError=C(d,r,g,K)))},l(0),A._updateFileDetails(k,!1)},_updateFileDetails:function(j){var p=this,h=p.$element,m=p.getFileStack(),f=aZ(9)&&aI(h.val())||h[0].files[0]&&h[0].files[0].name||m.length&&m[0].name||"",b=p.slug(f),c=p.isUploadable?m.length:j,g=a2.count(p.id)+c,k=c>1?p._getMsgSelected(g):b;p.isError?(p.$previewContainer.removeClass("file-thumb-loading"),p.$previewStatus.html(""),p.$captionContainer.find(".kv-caption-icon").hide()):p._showFileIcon(),p._setCaption(k,p.isError),p.$container.removeClass("file-input-new file-input-ajax-new"),1===arguments.length&&p._raise("fileselect",[j,b]),a2.count(p.id)&&p._initPreviewActions()},_setThumbStatus:function(h,f){var d=this;if(d.showPreview){var c="indicator"+f,k=c+"Title",g="file-preview-"+f.toLowerCase(),j=h.find(".file-upload-indicator"),b=d.fileActionSettings;h.removeClass("file-preview-success file-preview-error file-preview-loading"),"Error"===f&&h.find(".kv-file-upload").attr("disabled",!0),"Success"===f&&(h.find(".file-drag-handle").remove(),j.css("margin-left",0)),j.html(b[c]),j.attr("title",b[k]),h.addClass(g)}},_setProgressCancelled:function(){var a=this;a._setProgress(100,a.$progress,a.msgCancelled)},_setProgress:function(g,d,c){var b=this,h=Math.min(g,100),f=100>h?b.progressTemplate:c?b.progressErrorTemplate:b.progressCompleteTemplate;d=d||b.$progress,aa(f)||(d.html(f.replace(/\{percent}/g,h)),c&&d.find('[role="progressbar"]').html(c))},_setFileDropZoneTitle:function(){var b=this,a=b.$container.find(".file-drop-zone");a.find("."+b.dropZoneTitleClass).remove(),b.isUploadable&&b.showPreview&&0!==a.length&&!(b.getFileStack().length>0)&&b.dropZoneEnabled&&(0===a.find(".file-preview-frame").length&&aa(b.defaultPreviewContent)&&a.prepend('<div class="'+b.dropZoneTitleClass+'">'+b.dropZoneTitle+"</div>"),b.$container.removeClass("file-input-new"),aW(b.$container,"file-input-ajax-new"))},_setAsyncUploadStatus:function(d,c,b){var f=this,e=0;f._setProgress(c,bd("#"+d).find(".file-thumb-progress")),f.uploadStatus[d]=c,bd.each(f.uploadStatus,function(g,a){e+=a}),f._setProgress(Math.ceil(e/b))},_validateMinCount:function(){var b=this,a=b.isUploadable?b.getFileStack().length:b.$element.get(0).files.length;return b.validateInitialCount&&b.minFileCount>0&&b._getFileCount(a-1)<b.minFileCount?(b._noFilesError({}),!1):!0},_getFileCount:function(c){var b=this,a=0;return b.validateInitialCount&&!b.overwriteInitial&&(a=a2.count(b.id),c+=a),c},_getFileName:function(a){return a&&a.name?this.slug(a.name):void 0},_getFileNames:function(b){var a=this;return a.filenames.filter(function(c){return b?void 0!==c:void 0!==c&&null!==c})},_setPreviewError:function(f,d,c){var b=this;d&&b.updateStack(d,c),b.removeFromPreviewOnError?f.remove():b._setThumbStatus(f,"Error")},_checkDimensions:function(v,A,m,y,j,b,h){var k,B,w,x,g=this,z="Small"===A?"min":"max",q=g[z+"Image"+b];!aa(q)&&m.length&&(w=m[0],B="Width"===b?w.naturalWidth||w.width:w.naturalHeight||w.height,x="Small"===A?B>=q:q>=B,x||(k=g["msgImage"+b+A].replace("{name}",j).replace("{size}",q),g._showUploadError(k,h),g._setPreviewError(y,v,null)))},_validateImage:function(j,q,h,m){var f,b,g,v=this,k=v.$preview,c=k.find("#"+q),o=c.find("img");h=h||"Untitled",o.length&&bf(o,"load",function(){b=c.width(),g=k.width(),b>g&&(o.css("width","100%"),c.css("width","97%")),f={ind:j,id:q},v._checkDimensions(j,"Small",o,c,h,"Width",f),v._checkDimensions(j,"Small",o,c,h,"Height",f),v.resizeImage||(v._checkDimensions(j,"Large",o,c,h,"Width",f),v._checkDimensions(j,"Large",o,c,h,"Height",f)),v._raise("fileimageloaded",[q]),v.loadedImages.push({ind:j,img:o,thumb:c,pid:q,typ:m}),v._validateAllImages(),a3.revokeObjectURL(o.attr("src"))})},_validateAllImages:function(){var h,k,g,j,d,b,c,f=this,m={};if(f.loadedImages.length===f.totalImagesCount&&(f._raise("fileimagesloaded"),f.resizeImage)){for(c=f.isUploadable?f._showUploadError:f._showError,h=0;h<f.loadedImages.length;h++){k=f.loadedImages[h],g=k.img,j=k.thumb,d=k.pid,b=k.ind,m={id:d,index:b},f._getResizedImage(g[0],k.typ,d,b)||(c(f.msgImageResizeError,m,"fileimageresizeerror"),f._setPreviewError(j,b))}f._raise("fileimagesresized")}},_getResizedImage:function(z,E,w,C){var k,b,j=this,v=z.naturalWidth,F=z.naturalHeight,A=1,B=j.maxImageWidth||v,h=j.maxImageHeight||F,D=v&&F,y=j.imageCanvas,q=j.imageCanvasContext;if(!D){return !1}if(v===B&&F===h){return !0}E=E||j.resizeDefaultImageType,k=v>B,b=F>h,A="width"===j.resizePreference?k?B/v:b?h/F:1:b?h/F:k?B/v:1,j._resetCanvas(),v*=A,F*=A,y.width=v,y.height=F;try{return q.drawImage(z,0,0,v,F),y.toBlob(function(a){j._raise("fileimageresized",[w,C]),j.filestack[C]=a},E,j.resizeQuality),!0}catch(x){return !1}},_initBrowse:function(b){var a=this;a.$btnFile=b.find(".btn-file"),a.$btnFile.append(a.$element)},_initCaption:function(){var b=this,a=b.initialCaption||"";return b.overwriteInitial||aa(a)?(b.$caption.html(""),!1):(b._setCaption(a),!0)},_setCaption:function(e,d){var c,j,g,h,b=this,f=b.getFileStack();if(b.$caption.length){if(d){c=bd("<div>"+b.msgValidationError+"</div>").text(),g=f.length,h=g?1===g&&f[0]?b._getFileNames()[0]:b._getMsgSelected(g):b._getMsgSelected(b.msgNo),j='<span class="'+b.msgValidationErrorClass+'">'+b.msgValidationErrorIcon+(aa(e)?h:e)+"</span>"}else{if(aa(e)){return}c=bd("<div>"+e+"</div>").text(),j=b._getLayoutTemplate("fileIcon")+c}b.$caption.html(j),b.$caption.attr("title",c),b.$captionContainer.find(".file-caption-ellipsis").attr("title",c)}},_createContainer:function(){var b=this,a=bd(document.createElement("div")).attr({"class":"file-input file-input-new"}).html(b._renderMain());return b.$element.before(a),b._initBrowse(a),b.theme&&a.addClass("theme-"+b.theme),a},_refreshContainer:function(){var b=this,a=b.$container;a.before(b.$element),a.html(b._renderMain()),b._initBrowse(a)},_renderMain:function(){var g=this,d=g.isUploadable&&g.dropZoneEnabled?" file-drop-zone":"file-drop-disabled",c=g.showClose?g._getLayoutTemplate("close"):"",b=g.showPreview?g._getLayoutTemplate("preview").replace(/\{class}/g,g.previewClass).replace(/\{dropClass}/g,d):"",h=g.isDisabled?g.captionClass+" file-caption-disabled":g.captionClass,f=g.captionTemplate.replace(/\{class}/g,h+" kv-fileinput-caption");return g.mainTemplate.replace(/\{class}/g,g.mainClass).replace(/\{preview}/g,b).replace(/\{close}/g,c).replace(/\{caption}/g,f).replace(/\{upload}/g,g._renderButton("upload")).replace(/\{remove}/g,g._renderButton("remove")).replace(/\{cancel}/g,g._renderButton("cancel")).replace(/\{browse}/g,g._renderButton("browse"))},_renderButton:function(h){var k=this,g=k._getLayoutTemplate("btnDefault"),j=k[h+"Class"],d=k[h+"Title"],b=k[h+"Icon"],c=k[h+"Label"],f=k.isDisabled?" disabled":"",m="button";switch(h){case"remove":if(!k.showRemove){return""}break;case"cancel":if(!k.showCancel){return""}j+=" hide";break;case"upload":if(!k.showUpload){return""}k.isUploadable&&!k.isDisabled?g=k._getLayoutTemplate("btnLink").replace("{href}",k.uploadUrl):m="submit";break;case"browse":g=k._getLayoutTemplate("btnBrowse");break;default:return""}return j+="browse"===h?" btn-file":" fileinput-"+h+" fileinput-"+h+"-button",aa(c)||(c=' <span class="'+k.buttonLabelClass+'">'+c+"</span>"),g.replace("{type}",m).replace("{css}",j).replace("{title}",d).replace("{status}",f).replace("{icon}",b).replace("{label}",c)},_renderThumbProgress:function(){return'<div class="file-thumb-progress hide">'+this.progressTemplate.replace(/\{percent}/g,"0")+"</div>"},_renderFileFooter:function(v,A,m,y){var j,b=this,h=b.fileActionSettings,k=h.showRemove,B=h.showDrag,w=h.showUpload,x=h.showZoom,g=b._getLayoutTemplate("footer"),z=y?h.indicatorError:h.indicatorNew,q=y?h.indicatorErrorTitle:h.indicatorNewTitle;return A=b._getSize(A),j=b.isUploadable?g.replace(/\{actions}/g,b._renderFileActions(k,w,x,B,!1,!1,!1)).replace(/\{caption}/g,v).replace(/\{size}/g,A).replace(/\{width}/g,m).replace(/\{progress}/g,b._renderThumbProgress()).replace(/\{indicator}/g,z).replace(/\{indicatorTitle}/g,q):g.replace(/\{actions}/g,b._renderFileActions(!1,!1,x,B,!1,!1,!1)).replace(/\{caption}/g,v).replace(/\{size}/g,A).replace(/\{width}/g,m).replace(/\{progress}/g,"").replace(/\{indicator}/g,z).replace(/\{indicatorTitle}/g,q),j=aD(j,b.previewThumbTags)},_renderFileActions:function(I,q,E,L,B,y,A,D){if(!(I||q||E||L)){return""}var x,J=this,K=y===!1?"":' data-url="'+y+'"',z=A===!1?"":' data-key="'+A+'"',k="",H="",C="",G="",j=J._getLayoutTemplate("actions"),F=J.fileActionSettings,b=J.otherActionButtons.replace(/\{dataKey}/g,z),M=B?F.removeClass+" disabled":F.removeClass;return q&&(k=J._getLayoutTemplate("actionDelete").replace(/\{removeClass}/g,M).replace(/\{removeIcon}/g,F.removeIcon).replace(/\{removeTitle}/g,F.removeTitle).replace(/\{dataUrl}/g,K).replace(/\{dataKey}/g,z)),I&&(H=J._getLayoutTemplate("actionUpload").replace(/\{uploadClass}/g,F.uploadClass).replace(/\{uploadIcon}/g,F.uploadIcon).replace(/\{uploadTitle}/g,F.uploadTitle)),E&&(C=J._getLayoutTemplate("actionZoom").replace(/\{zoomClass}/g,F.zoomClass).replace(/\{zoomIcon}/g,F.zoomIcon).replace(/\{zoomTitle}/g,F.zoomTitle)),L&&D&&(x="drag-handle-init "+F.dragClass,G=J._getLayoutTemplate("actionDrag").replace(/\{dragClass}/g,x).replace(/\{dragTitle}/g,F.dragTitle).replace(/\{dragIcon}/g,F.dragIcon)),j.replace(/\{delete}/g,k).replace(/\{upload}/g,H).replace(/\{zoom}/g,C).replace(/\{drag}/g,G).replace(/\{other}/g,b)},_browse:function(b){var a=this;a._raise("filebrowse"),b&&b.isDefaultPrevented()||(a.isError&&!a.isUploadable&&a.clear(),a.$captionContainer.focus())},_change:function(k){var B=this,H=B.$element;if(!B.isUploadable&&aa(H.val())&&B.fileInputCleared){return void (B.fileInputCleared=!1)}B.fileInputCleared=!1;var y,q,x,A,p,F,G=arguments.length>1,j=B.isUploadable,E=0,z=G?k.originalEvent.dataTransfer.files:H.get(0).files,D=B.filestack.length,e=aa(H.attr("multiple")),C=e&&D>0,b=0,I=function(f,d,i,g){var h=bd.extend(!0,{},B._getOutData({},{},z),{id:i,index:g}),c={id:i,index:g,file:d,files:z};return B.isUploadable?B._showUploadError(f,h):B._showError(f,c)};if(B.reader=null,B._resetUpload(),B._hideFileIcon(),B.isUploadable&&B.$container.find(".file-drop-zone ."+B.dropZoneTitleClass).remove(),G){for(y=[];z[E];){A=z[E],A.type||A.size%4096!==0?y.push(A):b++,E++}}else{y=void 0===k.target.files?k.target&&k.target.value?[{name:k.target.value.replace(/^.+\\/,"")}]:[]:k.target.files}if(aa(y)||0===y.length){return j||B.clear(),B._showFolderError(b),void B._raise("fileselectnone")}if(B._resetErrors(),F=y.length,x=B._getFileCount(B.isUploadable?B.getFileStack().length+F:F),B.maxFileCount>0&&x>B.maxFileCount){if(!B.autoReplace||F>B.maxFileCount){return p=B.autoReplace&&F>B.maxFileCount?F:x,q=B.msgFilesTooMany.replace("{m}",B.maxFileCount).replace("{n}",p),B.isError=I(q,null,null,null),B.$captionContainer.find(".kv-caption-icon").hide(),B._setCaption("",!0),void B.$container.removeClass("file-input-new file-input-ajax-new")}x>B.maxFileCount&&B._resetPreviewThumbs(j)}else{!j||C?(B._resetPreviewThumbs(!1),C&&B.clearStack()):!j||0!==D||a2.count(B.id)&&!B.overwriteInitial||B._resetPreviewThumbs(!0)}B.isPreviewable?B._readFiles(y):B._updateFileDetails(1),B._showFolderError(b)},_abort:function(d){var c,b=this;return b.ajaxAborted&&"object"==typeof b.ajaxAborted&&void 0!==b.ajaxAborted.message?(c=bd.extend(!0,{},b._getOutData(),d),c.abortData=b.ajaxAborted.data||{},c.abortMessage=b.ajaxAborted.message,b.cancel(),b._setProgress(100,b.$progress,b.msgCancelled),b._showUploadError(b.ajaxAborted.message,c,"filecustomerror"),!0):!1},_resetFileStack:function(){var d=this,c=0,b=[],e=[];d._getThumbs().each(function(){var f=bd(this),g=f.attr("data-fileindex"),a=d.filestack[g];-1!==g&&(void 0!==a?(b[c]=a,e[c]=d._getFileName(a),f.attr({id:d.previewInitId+"-"+c,"data-fileindex":c}),c++):f.attr({id:"uploaded-"+aO(),"data-fileindex":"-1"}))}),d.filestack=b,d.filenames=e},clearStack:function(){var a=this;return a.filestack=[],a.filenames=[],a.$element},updateStack:function(c,b){var a=this;return a.filestack[c]=b,a.filenames[c]=a._getFileName(b),a.$element},addToStack:function(b){var a=this;return a.filestack.push(b),a.filenames.push(a._getFileName(b)),a.$element},getFileStack:function(b){var a=this;return a.filestack.filter(function(c){return b?void 0!==c:void 0!==c&&null!==c})},lock:function(){var a=this;return a._resetErrors(),a.disable(),a.showRemove&&aW(a.$container.find(".fileinput-remove"),"hide"),a.showCancel&&a.$container.find(".fileinput-cancel").removeClass("hide"),a._raise("filelock",[a.filestack,a._getExtraData()]),a.$element},unlock:function(b){var a=this;return void 0===b&&(b=!0),a.enable(),a.showCancel&&aW(a.$container.find(".fileinput-cancel"),"hide"),a.showRemove&&a.$container.find(".fileinput-remove").removeClass("hide"),b&&a._resetFileStack(),a._raise("fileunlock",[a.filestack,a._getExtraData()]),a.$element},cancel:function(){var d,c=this,b=c.ajaxRequests,e=b.length;if(e>0){for(d=0;e>d;d+=1){c.cancelling=!0,b[d].abort()}}return c._setProgressCancelled(),c._getThumbs().each(function(){var g=bd(this),f=g.attr("data-fileindex");g.removeClass("file-uploading"),void 0!==c.filestack[f]&&(g.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled"),g.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled")),c.unlock()}),c.$element},clear:function(){var b,a=this;return a.$btnUpload.removeAttr("disabled"),a._getThumbs().find("video,audio,img").each(function(){aL(bd(this))}),a._resetUpload(),a.clearStack(),a._clearFileInput(),a._resetErrors(!0),a._raise("fileclear"),a._hasInitialPreview()?(a._showFileIcon(),a._resetPreview(),a._initPreviewActions(),a.$container.removeClass("file-input-new")):(a._getThumbs().each(function(){a._clearObjects(bd(this))}),a.isUploadable&&(a2.data[a.id]={}),a.$preview.html(""),b=!a.overwriteInitial&&a.initialCaption.length>0?a.initialCaption:"",a._setCaption(b),a.$caption.attr("title",""),aW(a.$container,"file-input-new"),a._validateDefaultPreview()),0===a.$container.find(".file-preview-frame").length&&(a._initCaption()||a.$captionContainer.find(".kv-caption-icon").hide()),a._hideFileIcon(),a._raise("filecleared"),a.$captionContainer.focus(),a._setFileDropZoneTitle(),a.$element},reset:function(){var a=this;return a._resetPreview(),a.$container.find(".fileinput-filename").text(""),a._raise("filereset"),aW(a.$container,"file-input-new"),(a.$preview.find(".file-preview-frame").length||a.isUploadable&&a.dropZoneEnabled)&&a.$container.removeClass("file-input-new"),a._setFileDropZoneTitle(),a.clearStack(),a.formdata={},a.$element},disable:function(){var a=this;return a.isDisabled=!0,a._raise("filedisabled"),a.$element.attr("disabled","disabled"),a.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled"),a.$container.find(".btn-file, .fileinput-remove, .fileinput-upload, .file-preview-frame button").attr("disabled",!0),a._initDragDrop(),a.$element},enable:function(){var a=this;return a.isDisabled=!1,a._raise("fileenabled"),a.$element.removeAttr("disabled"),a.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled"),a.$container.find(".btn-file, .fileinput-remove, .fileinput-upload, .file-preview-frame button").removeAttr("disabled"),a._initDragDrop(),a.$element},upload:function(){var e,d,c,h=this,f=h.getFileStack().length,g={},b=!bd.isEmptyObject(h._getExtraData());if(h.minFileCount>0&&h._getFileCount(f)<h.minFileCount){return void h._noFilesError(g)}if(h.isUploadable&&!h.isDisabled&&(0!==f||b)){if(h._resetUpload(),h.$progress.removeClass("hide"),h.uploadCount=0,h.uploadStatus={},h.uploadLog=[],h.lock(),h._setProgress(2),0===f&&b){return void h._uploadExtraOnly()}if(c=h.filestack.length,h.hasInitData=!1,!h.uploadAsync){return h._uploadBatch(),h.$element}for(d=h._getOutData(),h._raise("filebatchpreupload",[d]),h.fileBatchCompleted=!1,h.uploadCache={content:[],config:[],tags:[],append:!0},h.uploadAsyncCount=h.getFileStack().length,e=0;c>e;e++){h.uploadCache.content[e]=null,h.uploadCache.config[e]=null,h.uploadCache.tags[e]=null}for(e=0;c>e;e++){void 0!==h.filestack[e]&&h._uploadSingle(e,h.filestack,!0)}}},destroy:function(){var b=this,a=b.$container;return a.find(".file-drop-zone").off(),b.$element.insertBefore(a).off(aY).removeData(),a.off().remove(),b.$element},refresh:function(d){var c=this,b=c.$element;return d=d?bd.extend(!0,{},c.options,d):c.options,c.destroy(),b.fileinput(d),b.val()&&b.trigger("change.fileinput"),b}},bd.fn.fileinput=function(d){if(bc()||aZ(9)){var c=Array.apply(null,arguments),b=[];switch(c.shift(),this.each(function(){var k,f=bd(this),i=f.data("fileinput"),a="object"==typeof d&&d,e=a.theme||f.data("theme"),h={},j={},g=a.language||f.data("language")||"en";i||(e&&(j=bd.fn.fileinputThemes[e]||{}),"en"===g||aa(bd.fn.fileinputLocales[g])||(h=bd.fn.fileinputLocales[g]||{}),k=bd.extend(!0,{},bd.fn.fileinput.defaults,j,bd.fn.fileinputLocales.en,h,a,f.data()),i=new aG(this,k),f.data("fileinput",i)),"string"==typeof d&&b.push(i[d].apply(i,c))}),b.length){case 0:return this;case 1:return b[0];default:return b}}},bd.fn.fileinput.defaults={language:"en",showCaption:!0,showPreview:!0,showRemove:!0,showUpload:!0,showCancel:!0,showClose:!0,showUploadedThumbs:!0,autoReplace:!1,previewClass:"",captionClass:"",mainClass:"",mainTemplate:null,purifyHtml:!0,fileSizeGetter:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewAsData:!1,initialPreviewFileType:"image",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:!0,removeFromPreviewOnError:!1,deleteUrl:"",deleteExtraData:{},overwriteInitial:!0,layoutTemplates:ac,previewTemplates:au,previewZoomSettings:am,previewZoomButtonIcons:{prev:'<i class="glyphicon glyphicon-triangle-left"></i>',next:'<i class="glyphicon glyphicon-triangle-right"></i>',toggleheader:'<i class="glyphicon glyphicon-resize-vertical"></i>',fullscreen:'<i class="glyphicon glyphicon-fullscreen"></i>',borderless:'<i class="glyphicon glyphicon-resize-full"></i>',close:'<i class="glyphicon glyphicon-remove"></i>'},previewZoomButtonClasses:{prev:"btn btn-navigate",next:"btn btn-navigate",toggleheader:"btn btn-default btn-header-toggle",fullscreen:"btn btn-default",borderless:"btn btn-default",close:"btn btn-default"},allowedPreviewTypes:null,allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,defaultPreviewContent:null,customLayoutTags:{},customPreviewTags:{},previewSettings:aN,fileTypeSettings:aA,previewFileIcon:'<i class="glyphicon glyphicon-file"></i>',previewFileIconClass:"file-other-icon",previewFileIconSettings:{},previewFileExtSettings:{},buttonLabelClass:"hidden-xs",browseIcon:'<i class="glyphicon glyphicon-folder-open"></i>&nbsp;',browseClass:"btn btn-primary",removeIcon:'<i class="glyphicon glyphicon-trash"></i>',removeClass:"btn btn-default",cancelIcon:'<i class="glyphicon glyphicon-ban-circle"></i>',cancelClass:"btn btn-default",uploadIcon:'<i class="glyphicon glyphicon-upload"></i>',uploadClass:"btn btn-default",uploadUrl:null,uploadAsync:!0,uploadExtraData:{},zoomModalHeight:480,minImageWidth:null,minImageHeight:null,maxImageWidth:null,maxImageHeight:null,resizeImage:!1,resizePreference:"width",resizeQuality:0.92,resizeDefaultImageType:"image/jpeg",maxFileSize:0,maxFilePreviewSize:25600,minFileCount:0,maxFileCount:0,validateInitialCount:!1,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"></i> ',msgErrorClass:"file-error-message",progressThumbClass:"progress-bar progress-bar-success progress-bar-striped active",progressClass:"progress-bar progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar progress-bar-success",progressErrorClass:"progress-bar progress-bar-danger",previewFileType:"image",elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,errorCloseButton:'<span class="close kv-error-close">&times;</span>',slugCallback:null,dropZoneEnabled:!0,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:!0},bd.fn.fileinputLocales.en={fileSingle:"文件",filePlural:"多个文件",browseLabel:"选择 &hellip;",removeLabel:"移除",removeTitle:"清除选中文件",cancelLabel:"取消",cancelTitle:"取消进行中的上传",uploadLabel:"上传",uploadTitle:"上传选中文件",msgNo:"没有",msgCancelled:"取消",msgZoomTitle:"查看详情",msgZoomModalHeading:"详细预览",msgSizeTooLarge:'文件 "{name}" (<b>{size} KB</b>) 超过了允许大小 <b>{maxSize} KB</b>.',msgFilesTooLess:"你必须选择最少 <b>{n}</b> {files} 来上传. ",msgFilesTooMany:"选择的上传文件个数 <b>({n})</b> 超出最大文件的限制个数 <b>{m}</b>.",msgFileNotFound:'文件 "{name}" 未找到!',msgFileSecured:'安全限制，为了防止读取文件 "{name}".',msgFileNotReadable:'文件 "{name}" 不可读.',msgFilePreviewAborted:'取消 "{name}" 的预览.',msgFilePreviewError:'读取 "{name}" 时出现了一个错误.',msgInvalidFileType:'不正确的类型 "{name}". 只支持 "{types}" 类型的文件.',msgInvalidFileExtension:'不正确的文件扩展名 "{name}". 只支持 "{extensions}" 的文件扩展名.',msgUploadAborted:"该文件上传被中止",msgValidationError:"验证错误",msgLoading:"加载第 {index} 文件 共 {files} &hellip;",msgProgress:"加载第 {index} 文件 共 {files} - {name} - {percent}% 完成.",msgSelected:"{n} {files} 选中",msgFoldersNotAllowed:"只支持拖拽文件! 跳过 {n} 拖拽的文件夹.",msgImageWidthSmall:'宽度的图像文件的"{name}"的必须是至少{size}像素.',msgImageHeightSmall:'图像文件的"{name}"的高度必须至少为{size}像素.',msgImageWidthLarge:'宽度的图像文件"{name}"不能超过{size}像素.',msgImageHeightLarge:'图像文件"{name}"的高度不能超过{size}像素.',msgImageResizeError:"无法获取的图像尺寸调整。",msgImageResizeException:"错误而调整图像大小。<pre>{errors}</pre>",dropZoneTitle:"拖拽文件到这里 &hellip;",fileActionSettings:{removeTitle:"删除文件",uploadTitle:"上传文件",indicatorNewTitle:"没有上传",indicatorSuccessTitle:"上传",indicatorErrorTitle:"上传错误",indicatorLoadingTitle:"上传 ..."},previewZoomButtonTitles:{prev:"查看上一个文件",next:"查看下一个文件",toggleheader:"头部合并",fullscreen:"全屏",borderless:"缩放",close:"关闭预览"}},bd.fn.fileinput.Constructor=aG,bd(document).ready(function(){var a=bd("input.file[type=file]");a.length&&a.fileinput()})});